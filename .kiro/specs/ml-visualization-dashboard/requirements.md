# 要件定義書

## はじめに

本ドキュメントは、scikit-learnのデータセットを用いた機械学習モデルの学習・評価・可視化を行うWebダッシュボードシステムの要件を定義する。システムはStreamlitによるフロントエンド、FastAPIによるバックエンド、Redis/PostgreSQLによるデータ永続化で構成され、Dockerコンテナ環境で動作する。

## 用語集

- **MLダッシュボード**: 機械学習モデルの学習と評価を行うWebダッシュボードシステム
- **Streamlitフロントエンド**: ユーザーインターフェースを提供するStreamlitアプリケーション
- **FastAPIバックエンド**: モデル学習とデータ処理を担当するRESTful APIサーバー
- **Redisキャッシュ**: 学習データセットをキャッシュするインメモリデータストア
- **PostgreSQLデータベース**: 実験パラメータと履歴を永続化するリレーショナルデータベース
- **実験**: 特定のデータセット・モデル・ハイパーパラメータの組み合わせによる学習実行
- **Scikit-learnデータセット**: Iris, Wine, Breast Cancer, Digitsなどのscikit-learn組み込みデータセット

## 要件

### 要件1

**ユーザーストーリー:** データサイエンティストとして、異なるデータセットを選択しtrain/test分割パラメータを設定したい。様々なデータ構成で実験できるようにするため。

#### 受け入れ基準

1. WHEN ユーザーがドロップダウンからデータセットを選択する THEN MLダッシュボード SHALL 対応するscikit-learnデータセットを読み込みメタデータを表示する
2. WHEN ユーザーがテスト分割比率スライダーを調整する THEN MLダッシュボード SHALL train/test分割比率を10%から50%の範囲で更新する
3. WHEN ユーザーが乱数シード値を入力する THEN MLダッシュボード SHALL そのシードを使用して再現可能なデータ分割を行う
4. WHEN データセットが読み込まれる THEN MLダッシュボード SHALL 先頭N行を色分けされたラベル付きでプレビューテーブルに表示する
5. WHEN データセットメタデータが表示される THEN MLダッシュボード SHALL データセット名、総サンプル数、特徴量数を表示する

### 要件2

**ユーザーストーリー:** 機械学習実践者として、異なるモデルタイプを選択しハイパーパラメータを設定したい。様々な構成でモデル性能を比較するため。

#### 受け入れ基準

1. WHEN ユーザーがドロップダウンからモデルタイプを選択する THEN MLダッシュボード SHALL そのモデルに関連するハイパーパラメータコントロールのみを表示する
2. WHEN ユーザーがn_estimatorsスライダーを調整する THEN MLダッシュボード SHALL Random ForestとGradient Boostingモデルの木の本数を更新する
3. WHEN ユーザーがmax_depthスライダーを調整する THEN MLダッシュボード SHALL 木ベースモデルの最大深さを更新する
4. WHEN ユーザーがmin_samples_splitスライダーを調整する THEN MLダッシュボード SHALL ノード分割に必要な最小サンプル数を更新する
5. WHEN ユーザーがlearning_rateスライダーを調整する THEN MLダッシュボード SHALL Gradient Boostingモデルの勾配降下ステップサイズを更新する
6. WHEN ユーザーがCパラメータスライダーを調整する THEN MLダッシュボード SHALL SVMとLogistic Regressionの正則化強度を更新する
7. WHEN ユーザーがkパラメータスライダーを調整する THEN MLダッシュボード SHALL KNNモデルの近傍数を更新する

### 要件3

**ユーザーストーリー:** 研究者として、モデルを学習しリアルタイムで学習進捗を確認したい。学習プロセスを監視するため。

#### 受け入れ基準

1. WHEN ユーザーが学習開始ボタンをクリックする THEN FastAPIバックエンド SHALL モデルのfittingを実行し評価指標を返す
2. WHEN モデル学習が進行中である THEN Streamlitフロントエンド SHALL 学習状況を示すプログレスバーを表示する
3. WHEN モデル学習が完了する THEN MLダッシュボード SHALL すべてのメトリクスカードと可視化チャートを更新する
4. WHEN 学習が失敗する THEN MLダッシュボード SHALL エラーメッセージを表示し前の状態を維持する

### 要件4

**ユーザーストーリー:** モデル評価者として、包括的な評価指標と可視化を確認したい。モデル性能を評価するため。

#### 受け入れ基準

1. WHEN モデル学習が完了する THEN MLダッシュボード SHALL AccuracyカードにテストセットのAccuracyを表示する
2. WHEN モデル学習が完了する THEN MLダッシュボード SHALL F1 Scoreカードに加重F1スコアを表示する
3. WHEN モデル学習が完了する THEN MLダッシュボード SHALL Modelカードに学習済みモデル名を表示する
4. WHEN モデル学習が完了する THEN MLダッシュボード SHALL 混同行列ヒートマップを生成し表示する
5. WHEN 木ベースモデルが学習される THEN MLダッシュボード SHALL 特徴量重要度を降順で並べた横棒グラフを表示する
6. WHEN モデル学習が完了する THEN MLダッシュボード SHALL クラスごとのprecision、recall、F1スコアを含む分類レポートを展開可能なパネルに表示する

### 要件5

**ユーザーストーリー:** 実験者として、パラメータ設定を保存し実験履歴を追跡したい。複数回の実行結果を比較するため。

#### 受け入れ基準

1. WHEN ユーザーがパラメータ保存ボタンをクリックする THEN PostgreSQLデータベース SHALL 現在のハイパーパラメータ設定を永続化する
2. WHEN 学習実行が完了する THEN PostgreSQLデータベース SHALL モデルタイプ、データセット、Accuracy、F1スコアを含む実験記録を保存する
3. WHEN 実験記録が存在する THEN MLダッシュボード SHALL それらを時系列順に実験履歴テーブルに表示する
4. WHEN 複数の実験が記録される THEN MLダッシュボード SHALL 最良モデルをハイライトしたAccuracy推移棒グラフを表示する
5. WHEN ユーザーが履歴リセットボタンをクリックする THEN MLダッシュボード SHALL 表示とデータベースからすべての実験記録をクリアする

### 要件6

**ユーザーストーリー:** モデルデプロイ担当者として、学習済みモデルをエクスポートしたい。本番環境で使用するため。

#### 受け入れ基準

1. WHEN ユーザーがモデル出力ボタンをクリックする THEN MLダッシュボード SHALL 学習済みモデルをpickleファイルにシリアライズする
2. WHEN モデルシリアライズが完了する THEN MLダッシュボード SHALL pickleファイルのダウンロードリンクを提供する
3. WHEN モデルが学習されていない THEN MLダッシュボード SHALL モデル出力ボタンを無効化する

### 要件7

**ユーザーストーリー:** システム管理者として、データセットのキャッシングを使用したい。繰り返しのデータ読み込みを高速かつ効率的にするため。

#### 受け入れ基準

1. WHEN データセットが初めてリクエストされる THEN FastAPIバックエンド SHALL scikit-learnから読み込みRedisキャッシュに保存する
2. WHEN データセットが再度リクエストされる THEN FastAPIバックエンド SHALL 再読み込みせずRedisキャッシュから取得する
3. WHEN キャッシュされたデータが取得される THEN FastAPIバックエンド SHALL 100ミリ秒以内にデータセットを返す

### 要件8

**ユーザーストーリー:** 開発者として、システム全体をDockerコンテナで実行したい。デプロイを一貫性があり再現可能にするため。

#### 受け入れ基準

1. WHEN システムがデプロイされる THEN Streamlitフロントエンド SHALL 専用Dockerコンテナで実行される
2. WHEN システムがデプロイされる THEN FastAPIバックエンド SHALL 専用Dockerコンテナで実行される
3. WHEN システムがデプロイされる THEN Redisキャッシュ SHALL 専用Dockerコンテナで実行される
4. WHEN システムがデプロイされる THEN PostgreSQLデータベース SHALL 専用Dockerコンテナで実行される
5. WHEN コンテナが起動される THEN FastAPIバックエンド SHALL RedisキャッシュとPostgreSQLデータベースの両方に正常に接続する
6. WHEN StreamlitフロントエンドがAPIリクエストを行う THEN FastAPIバックエンド SHALL 適切なデータまたはエラーメッセージで応答する
7. WHEN FastAPIバックエンドが起動する THEN MLダッシュボード SHALL 環境変数で設定されたCORS設定を適用する
8. WHEN Streamlitフロントエンドが起動する THEN MLダッシュボード SHALL 環境変数で設定されたバックエンドAPIのURLに接続する

### 要件10

**ユーザーストーリー:** 開発者として、uvを使用してプロジェクトの依存関係を管理したい。モダンで高速なパッケージ管理を実現するため。

#### 受け入れ基準

1. WHEN プロジェクトがセットアップされる THEN MLダッシュボード SHALL uvを使用して依存関係を管理する
2. WHEN プロジェクトがセットアップされる THEN MLダッシュボード SHALL frontend と backend の2つのサブディレクトリでモノレポ構成を持つ
3. WHEN 各サブプロジェクトがビルドされる THEN MLダッシュボード SHALL それぞれ独立したpyproject.tomlファイルを持つ
4. WHEN 依存関係がインストールされる THEN MLダッシュボード SHALL uvを使用して高速にパッケージをインストールする

### 要件9

**ユーザーストーリー:** 品質保証エンジニアとして、バックエンドに包括的なテストを実装したい。システムの信頼性を確保するため。

#### 受け入れ基準

1. WHEN バックエンドコードが変更される THEN テストスイート SHALL pytestを使用してAPIエンドポイントを検証する
2. WHEN バックエンドコードが変更される THEN テストスイート SHALL pytestを使用してデータ処理関数を検証する
3. WHEN バックエンドコードが変更される THEN テストスイート SHALL pytestを使用してデータベース操作を検証する
4. WHEN すべてのテストが実行される THEN テストスイート SHALL 単純なモデルに対して30秒以内に完了する

