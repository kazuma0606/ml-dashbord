# 実装計画

- [x] 1. プロジェクト構造とuv環境のセットアップ





  - ルートディレクトリにpyproject.tomlを作成（モノレポ設定）
  - frontend/とbackend/のサブディレクトリを作成
  - 各サブディレクトリにpyproject.tomlを作成
  - uvを使用して依存関係を初期化
  - .gitignoreファイルを作成
  - _要件: 10.1, 10.2, 10.3, 10.4_

- [x] 2. Docker環境のセットアップ





  - Docker Compose設定ファイルを作成（FastAPI、Streamlit、Redis、PostgreSQL）
  - backend/Dockerfileを作成（uvを使用した依存関係インストール）
  - frontend/Dockerfileを作成（uvを使用した依存関係インストール）
  - 環境変数テンプレートを作成（.env.example）
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [x] 3. バックエンド基盤の実装




- [x] 3.1 環境変数設定とCORS設定の実装


  - backend/src/config.pyを実装（pydantic-settings使用）
  - 環境変数からCORS設定を読み込む機能を実装
  - backend/.env.exampleを作成（CORS設定含む）
  - _要件: 8.7_

- [x] 3.2 データモデルとスキーマの定義


  - Pydanticモデルを実装（TrainingConfig、TrainingResult、ExperimentRecord）
  - PostgreSQLスキーマを定義（experiments テーブル）
  - カスタム例外クラスを実装（DatasetNotFoundError、ModelTrainingError、DatabaseError）
  - _要件: 5.1, 5.2_

- [x] 3.3 データベース接続とリポジトリの実装


  - SQLAlchemyセットアップとセッション管理を実装
  - ExperimentRepositoryクラスを実装（save、get_all、clear操作）
  - データベース接続のリトライロジックを実装
  - _要件: 5.1, 5.2, 5.3, 5.5_

- [x] 3.4 プロパティテスト: パラメータ保存のラウンドトリップ







  - **プロパティ11: パラメータ保存のラウンドトリップ**
  - **検証: 要件 5.1**

- [x] 3.5 プロパティテスト: 実験記録の完全性






  - **プロパティ12: 実験記録の完全性**
  - **検証: 要件 5.2**

- [x] 3.6 プロパティテスト: 実験履歴の時系列順序






  - **プロパティ13: 実験履歴の時系列順序**
  - **検証: 要件 5.3**

- [x] 3.7 プロパティテスト: 履歴クリアの完全性






  - **プロパティ15: 履歴クリアの完全性**
  - **検証: 要件 5.5**

- [x] 4. データサービスの実装




- [x] 4.1 Redis接続とキャッシュ管理の実装


  - Redis接続セットアップとリトライロジックを実装
  - キャッシュキー生成とTTL管理を実装
  - _要件: 7.1, 7.2_

- [x] 4.2 DatasetLoaderクラスの実装


  - scikit-learnデータセット読み込み機能を実装
  - Redisキャッシング統合を実装
  - 利用可能なデータセット一覧取得機能を実装
  - _要件: 1.1, 7.1, 7.2_

- [x] 4.3 DataPreprocessorクラスの実装


  - データ分割機能を実装（train_test_split）
  - データプレビュー生成機能を実装
  - _要件: 1.2, 1.3, 1.4_

- [x] 4.4 プロパティテスト: データセット読み込みの完全性






  - **プロパティ1: データセット読み込みの完全性**
  - **検証: 要件 1.1, 1.5**

- [x] 4.5 プロパティテスト: データ分割比率の正確性






  - **プロパティ2: データ分割比率の正確性**
  - **検証: 要件 1.2**

- [x] 4.6 プロパティテスト: 乱数シードによる再現性






  - **プロパティ3: 乱数シードによる再現性**
  - **検証: 要件 1.3**

- [x] 4.7 プロパティテスト: データプレビューの正確性






  - **プロパティ4: データプレビューの正確性**
  - **検証: 要件 1.4**

- [x] 4.8 プロパティテスト: データセットキャッシュの保存







  - **プロパティ17: データセットキャッシュの保存**
  - **検証: 要件 7.1**

- [x] 4.9 プロパティテスト: キャッシュからの取得






  - **プロパティ18: キャッシュからの取得**
  - **検証: 要件 7.2**

- [x] 5. 機械学習サービスの実装




- [x] 5.1 ModelFactoryクラスの実装


  - モデルタイプに基づくモデルインスタンス化を実装
  - ハイパーパラメータ適用ロジックを実装
  - サポートされるモデル: Random Forest、Gradient Boosting、SVM、Logistic Regression、KNN
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7_

- [x] 5.2 ModelTrainerクラスの実装


  - モデル学習機能を実装
  - 学習時間計測を実装
  - エラーハンドリングとログ記録を実装
  - _要件: 3.1_

- [x] 5.3 MetricsCalculatorクラスの実装


  - Accuracy計算を実装
  - F1スコア計算を実装
  - 混同行列生成を実装
  - 分類レポート生成を実装
  - 特徴量重要度抽出を実装（木ベースモデル用）
  - _要件: 4.1, 4.2, 4.4, 4.5, 4.6_

- [x] 5.4 プロパティテスト: ハイパーパラメータ更新の一貫性






  - **プロパティ6: ハイパーパラメータ更新の一貫性**
  - **検証: 要件 2.2, 2.3, 2.4, 2.5, 2.6, 2.7**

- [ ] 5.5 プロパティテスト: モデル学習の成功





  - **プロパティ7: モデル学習の成功**
  - **検証: 要件 3.1**

- [x] 5.6 プロパティテスト: 学習完了後のメトリクス更新






  - **プロパティ8: 学習完了後のメトリクス更新**
  - **検証: 要件 3.3, 4.1, 4.2, 4.3, 4.4, 4.6**

- [x] 5.7 プロパティテスト: 特徴量重要度の降順性






  - **プロパティ10: 特徴量重要度の降順性**
  - **検証: 要件 4.5**

- [x] 5.8 プロパティテスト: モデルシリアライゼーションのラウンドトリップ






  - **プロパティ16: モデルシリアライゼーションのラウンドトリップ**
  - **検証: 要件 6.1**

- [ ] 6. FastAPI エンドポイントの実装
- [ ] 6.1 FastAPIアプリケーションとCORSミドルウェアの設定
  - main.pyでFastAPIアプリケーションを初期化
  - 環境変数からCORS設定を読み込みミドルウェアを追加
  - _要件: 8.7_

- [ ]* 6.2 プロパティテスト: CORS設定の環境変数制御
  - **プロパティ20: CORS設定の環境変数制御**
  - **検証: 要件 8.7**

- [ ] 6.3 データセット関連エンドポイントの実装
  - GET /api/datasets エンドポイントを実装
  - GET /api/datasets/{name} エンドポイントを実装
  - GET /api/datasets/{name}/preview エンドポイントを実装
  - _要件: 1.1, 1.4, 1.5_

- [ ] 6.4 モデル学習関連エンドポイントの実装
  - POST /api/train エンドポイントを実装
  - GET /api/models/{model_id} エンドポイントを実装
  - GET /api/models/{model_id}/export エンドポイントを実装
  - モデルのインメモリストレージを実装
  - _要件: 3.1, 6.1, 6.2_

- [ ] 6.5 実験履歴関連エンドポイントの実装
  - POST /api/experiments エンドポイントを実装
  - GET /api/experiments エンドポイントを実装
  - DELETE /api/experiments エンドポイントを実装
  - _要件: 5.1, 5.2, 5.3, 5.5_

- [ ] 6.6 エラーハンドラーの実装
  - カスタム例外ハンドラーを実装
  - 構造化ログを実装
  - _要件: 3.4_

- [ ]* 6.7 プロパティテスト: エラー時の状態不変性
  - **プロパティ9: エラー時の状態不変性**
  - **検証: 要件 3.4**

- [ ]* 6.8 プロパティテスト: APIレスポンスの適切性
  - **プロパティ19: APIレスポンスの適切性**
  - **検証: 要件 8.6**

- [ ]* 6.9 統合テスト: APIエンドポイント
  - すべてのエンドポイントの統合テストを実装
  - testcontainersを使用したデータベース・キャッシュテストを実装
  - _要件: 9.1, 9.2, 9.3_

- [ ] 7. チェックポイント - バックエンドテスト実行
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [ ] 8. Streamlit フロントエンドの実装
- [ ] 8.1 環境変数設定とAPIクライアントの実装
  - frontend/src/config.pyを実装（pydantic-settings使用）
  - 環境変数からバックエンドURLを読み込む機能を実装
  - frontend/.env.exampleを作成（API_BASE_URL設定含む）
  - MLAPIClientクラスを実装（環境変数からURLを取得）
  - リトライロジックとエラーハンドリングを実装
  - _要件: 8.6, 8.8_

- [ ]* 8.2 プロパティテスト: フロントエンドAPI接続の環境変数制御
  - **プロパティ21: フロントエンドAPI接続の環境変数制御**
  - **検証: 要件 8.8**

- [ ] 8.3 サイドバーコンポーネントの実装
  - データセット選択ドロップダウンを実装
  - テスト分割比率スライダーを実装
  - 乱数シード入力を実装
  - モデル選択ドロップダウンを実装
  - モデル別ハイパーパラメータスライダーを実装（動的表示）
  - パラメータ保存ボタンを実装
  - 履歴リセットボタンを実装
  - _要件: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 5.1, 5.5_

- [ ]* 8.4 プロパティテスト: モデル別ハイパーパラメータ表示
  - **プロパティ5: モデル別ハイパーパラメータ表示**
  - **検証: 要件 2.1**

- [ ] 8.5 メトリクス表示コンポーネントの実装
  - Accuracyカードを実装
  - F1 Scoreカードを実装
  - モデル名カードを実装
  - データセット情報カードを実装
  - _要件: 4.1, 4.2, 4.3, 1.5_

- [ ] 8.6 可視化コンポーネントの実装
  - データプレビューテーブルを実装（色分けラベル付き）
  - 混同行列ヒートマップを実装
  - 特徴量重要度横棒グラフを実装
  - 実験履歴テーブルを実装
  - Accuracy推移棒グラフを実装（最良モデルハイライト）
  - 分類レポート展開パネルを実装
  - _要件: 1.4, 4.4, 4.5, 4.6, 5.3, 5.4_

- [ ]* 8.7 プロパティテスト: 最良モデルの識別
  - **プロパティ14: 最良モデルの識別**
  - **検証: 要件 5.4**

- [ ] 8.8 メインアプリケーションの統合
  - app.pyメインファイルを実装
  - 学習開始ボタンとプログレスバーを実装
  - モデル出力ボタンを実装（学習済みモデルがある場合のみ有効）
  - セッション状態管理を実装
  - エラー表示とトースト通知を実装
  - _要件: 3.1, 3.2, 3.3, 3.4, 6.1, 6.2, 6.3_

- [ ] 9. Docker統合とデプロイ設定
- [ ] 9.1 Docker Composeの最終調整
  - サービス間の依存関係を設定
  - 環境変数を設定（CORS、API URL含む）
  - ヘルスチェックを設定
  - _要件: 8.5_

- [ ] 9.2 起動スクリプトとドキュメントの作成
  - README.mdを作成（セットアップ手順、使用方法、uv使用方法）
  - 起動スクリプトを作成
  - ルート.env.exampleを作成（全体設定）
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5, 10.1_

- [ ]* 9.3 プロパティテスト: モノレポ構成の独立性
  - **プロパティ22: モノレポ構成の独立性**
  - **検証: 要件 10.2, 10.3**

- [ ] 10. 最終チェックポイント - 統合テスト
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する
